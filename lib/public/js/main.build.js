(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function setWinner(data) {
  var tmp = JSON.stringify(data);
  localStorage.setItem("winners", tmp);
}

function getWinners() {
  var listWorker = localStorage.getItem("winners");

  if (listWorker) {
    return JSON.parse(listWorker);
  }

  return [];
}

function get_winner() {
  $.ajax({
    url: '/get_winner',
    type: 'GET',
    success: function success(winner_name) {
      var winners = getWinners();

      if (winners.includes(winner_name)) {
        get_winner();
        return;
      }

      winners.push(winner_name);
      winner_url = winner_name;
      setWinner(winners);
      handleStop(winner_name);
    }
  });
}

function change_image_data() {
  $.ajax({
    url: '/new_turn',
    type: 'GET',
    dataType: 'json',
    success: function success(data) {
      for (var i = 0; i < data.files.length; i++) {
        var elem = $('.bee3D--slide').eq(i).find('div');
        elem.css({
          background: 'url(public/upload/' + data.files[i] + ') no-repeat 50% 50%',
          backgroundSize: 'cover'
        });
        elem.data('imageUrl', data.files[i]);
      }
    }
  });
}

function handleStop(winner_url) {
  var img = new Image();

  img.onload = function () {
    var winnerElm = $('.bee3D--slide').eq(7).find('div');
    var beforeElm = $('.bee3D--slide').eq(6).find('div');
    var afterElm = $('.bee3D--slide').eq(8).find('div');

    if (afterElm.data('imageUrl') == winner_url) {
      var dummy = $('.bee3D--slide').eq(1).find('div').data('imageUrl');
      afterElm.css({
        background: 'url(public/upload/' + dummy + ') no-repeat 50% 50%',
        backgroundSize: 'cover'
      });
      afterElm.data('imageUrl', dummy);
    }

    if (beforeElm.data('imageUrl') == winner_url) {
      var _dummy = $('.bee3D--slide').eq(8).find('div').data('imageUrl');

      beforeElm.css({
        background: 'url(public/upload/' + _dummy + ') no-repeat 50% 50%',
        backgroundSize: 'cover'
      });
      beforeElm.data('imageUrl', _dummy);
    }

    winnerElm.css({
      background: 'url(public/upload/' + winner_url + ') no-repeat 50% 50%',
      backgroundSize: 'cover'
    });
    winnerElm.data('imageUrl', winner_url);
    slider.el.on('activate', function (event) {
      if (event.index == 7 && need_to_stop) {
        clearInterval(_interval);
        need_to_stop = false;
        setTimeout(function () {
          winnerElm.addClass('winner-effect');
        }, 700);
      }
    });
  };

  img.src = "/public/upload/" + winner_url;
}

var slider = null;
var _interval = null;
var need_to_stop = false;
var winner_url = null;
var running = false;
$(function () {
  var demo = document.getElementById('demo');
  slider = new Bee3D(demo, {
    effect: 'carousel',
    listeners: {
      keys: false,
      scroll: false
    },
    loop: {
      enabled: true,
      continuous: true,
      offset: 8
    },
    autoplay: {
      enabled: false,
      speed: 100,
      pauseHover: true
    }
  });
  $(document).on('keyup', function (e) {
    console.log(e.keyCode);

    if (e.keyCode == 85) {
      window.location.href = '/upload-gallery';
    } else if (e.keyCode == 87) {
      window.location.href = '/winners';
    } else if (e.keyCode == 32) {
      if ($('#demo').data('total') == getWinners().length) {
        $.toast({
          text: 'Đã Quay Hết',
          showHideTransition: 'slide',
          bgColor: '#0184ff',
          textColor: '#fff',
          allowToastClose: false,
          hideAfter: 5000,
          stack: 5,
          textAlign: 'left',
          position: 'top-right'
        });
        return;
      }

      if (running) {
        running = false;
        need_to_stop = true;
        get_winner();
      } else {
        running = true;
        $('.winner-effect').removeClass('winner-effect');
        setTimeout(function () {
          change_image_data();
        }, 500);
        _interval = setInterval(function () {
          slider.el.next();
        }, 130);
      }
    }
  });
});

},{}],2:[function(require,module,exports){
'use strict';

require('./luckydraw');

},{"./luckydraw":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJsaWIvcHVibGljL2pzL2x1Y2t5ZHJhdy5qcyIsImxpYi9wdWJsaWMvanMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsU0FBUyxTQUFULENBQW1CLElBQW5CLEVBQXdCO0FBQ3BCLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBZixDQUFWO0FBQ0EsRUFBQSxZQUFZLENBQUMsT0FBYixDQUFxQixTQUFyQixFQUFnQyxHQUFoQztBQUNIOztBQUVELFNBQVMsVUFBVCxHQUFxQjtBQUNqQixNQUFJLFVBQVUsR0FBRyxZQUFZLENBQUMsT0FBYixDQUFxQixTQUFyQixDQUFqQjs7QUFDQSxNQUFJLFVBQUosRUFBZ0I7QUFDWixXQUFPLElBQUksQ0FBQyxLQUFMLENBQVcsVUFBWCxDQUFQO0FBQ0g7O0FBQ0QsU0FBTyxFQUFQO0FBQ0g7O0FBRUQsU0FBUyxVQUFULEdBQXFCO0FBQ2pCLEVBQUEsQ0FBQyxDQUFDLElBQUYsQ0FBTztBQUNILElBQUEsR0FBRyxFQUFFLGFBREY7QUFFSCxJQUFBLElBQUksRUFBRSxLQUZIO0FBR0gsSUFBQSxPQUFPLEVBQUUsaUJBQVMsV0FBVCxFQUFxQjtBQUMxQixVQUFJLE9BQU8sR0FBRyxVQUFVLEVBQXhCOztBQUNBLFVBQUcsT0FBTyxDQUFDLFFBQVIsQ0FBaUIsV0FBakIsQ0FBSCxFQUFpQztBQUM3QixRQUFBLFVBQVU7QUFDVjtBQUNIOztBQUNELE1BQUEsT0FBTyxDQUFDLElBQVIsQ0FBYSxXQUFiO0FBQ0EsTUFBQSxVQUFVLEdBQUcsV0FBYjtBQUNBLE1BQUEsU0FBUyxDQUFDLE9BQUQsQ0FBVDtBQUNBLE1BQUEsVUFBVSxDQUFDLFdBQUQsQ0FBVjtBQUNIO0FBYkUsR0FBUDtBQWVIOztBQUVELFNBQVMsaUJBQVQsR0FBNEI7QUFDdkIsRUFBQSxDQUFDLENBQUMsSUFBRixDQUFPO0FBQ0osSUFB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LFFBQUEsU0FBUyxHQUFHLFdBQVcsQ0FBQyxZQUFVO0FBQzlCLFVBQUEsTUFBTSxDQUFDLEVBQVAsQ0FBVSxJQUFWO0FBQ0gsU0FGc0IsRUFFcEIsR0FGb0IsQ0FBdkI7QUFHSDtBQUNKO0FBQ0osR0FwQ0Q7QUFxQ0gsQ0F6REEsQ0FBRDs7O0FDbkdBOztBQUNBLE9BQU8sQ0FBQyxhQUFELENBQVAiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJmdW5jdGlvbiBzZXRXaW5uZXIoZGF0YSl7XHJcbiAgICBsZXQgdG1wID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIndpbm5lcnNcIiwgdG1wKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0V2lubmVycygpe1xyXG4gICAgbGV0IGxpc3RXb3JrZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIndpbm5lcnNcIik7XHJcbiAgICBpZiAobGlzdFdvcmtlcikge1xyXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxpc3RXb3JrZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFtdO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRfd2lubmVyKCl7XHJcbiAgICAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogJy9nZXRfd2lubmVyJyxcclxuICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbih3aW5uZXJfbmFtZSl7XHJcbiAgICAgICAgICAgIGxldCB3aW5uZXJzID0gZ2V0V2lubmVycygpO1xyXG4gICAgICAgICAgICBpZih3aW5uZXJzLmluY2x1ZGVzKHdpbm5lcl9uYW1lKSl7XHJcbiAgICAgICAgICAgICAgICBnZXRfd2lubmVyKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgd2lubmVycy5wdXNoKHdpbm5lcl9uYW1lKTtcclxuICAgICAgICAgICAgd2lubmVyX3VybCA9IHdpbm5lcl9uYW1lO1xyXG4gICAgICAgICAgICBzZXRXaW5uZXIod2lubmVycyk7XHJcbiAgICAgICAgICAgIGhhbmRsZVN0b3Aod2lubmVyX25hbWUpXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoYW5nZV9pbWFnZV9kYXRhKCl7XHJcbiAgICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6ICcvbmV3X3R1cm4nLFxyXG4gICAgICAgIHR5cGU6ICdHRVQnLFxyXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBkYXRhLmZpbGVzLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGxldCBlbGVtID0gJCgnLmJlZTNELS1zbGlkZScpLmVxKGkpLmZpbmQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgZWxlbS5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwocHVibGljL3VwbG9hZC8nKyBkYXRhLmZpbGVzW2ldICsgJykgbm8tcmVwZWF0IDUwJSA1MCUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnY292ZXInXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGVsZW0uZGF0YSgnaW1hZ2VVcmwnLCBkYXRhLmZpbGVzW2ldKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZVN0b3Aod2lubmVyX3VybCl7XHJcbiAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxldCB3aW5uZXJFbG0gPSAkKCcuYmVlM0QtLXNsaWRlJykuZXEoNykuZmluZCgnZGl2Jyk7XHJcbiAgICAgICAgbGV0IGJlZm9yZUVsbSA9ICQoJy5iZWUzRC0tc2xpZGUnKS5lcSg2KS5maW5kKCdkaXYnKTtcclxuICAgICAgICBsZXQgYWZ0ZXJFbG0gPSAkKCcuYmVlM0QtLXNsaWRlJykuZXEoOCkuZmluZCgnZGl2Jyk7XHJcblxyXG4gICAgICAgIGlmKGFmdGVyRWxtLmRhdGEoJ2ltYWdlVXJsJykgPT0gd2lubmVyX3VybCl7XHJcbiAgICAgICAgICAgIGxldCBkdW1teSA9ICQoJy5iZWUzRC0tc2xpZGUnKS5lcSgxKS5maW5kKCdkaXYnKS5kYXRhKCdpbWFnZVVybCcpO1xyXG4gICAgICAgICAgICBhZnRlckVsbS5jc3Moe1xyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJ3VybChwdWJsaWMvdXBsb2FkLycrIGR1bW15ICsgJykgbm8tcmVwZWF0IDUwJSA1MCUnLFxyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICdjb3ZlcidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGFmdGVyRWxtLmRhdGEoJ2ltYWdlVXJsJywgZHVtbXkpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihiZWZvcmVFbG0uZGF0YSgnaW1hZ2VVcmwnKSA9PSB3aW5uZXJfdXJsKXtcclxuICAgICAgICAgICAgbGV0IGR1bW15ID0gJCgnLmJlZTNELS1zbGlkZScpLmVxKDgpLmZpbmQoJ2RpdicpLmRhdGEoJ2ltYWdlVXJsJyk7XHJcbiAgICAgICAgICAgIGJlZm9yZUVsbS5jc3Moe1xyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJ3VybChwdWJsaWMvdXBsb2FkLycrIGR1bW15ICsgJykgbm8tcmVwZWF0IDUwJSA1MCUnLFxyXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICdjb3ZlcidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGJlZm9yZUVsbS5kYXRhKCdpbWFnZVVybCcsIGR1bW15KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgd2lubmVyRWxtLmNzcyh7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwocHVibGljL3VwbG9hZC8nKyB3aW5uZXJfdXJsICsgJykgbm8tcmVwZWF0IDUwJSA1MCUnLFxyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJ2NvdmVyJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHdpbm5lckVsbS5kYXRhKCdpbWFnZVVybCcsIHdpbm5lcl91cmwpXHJcblxyXG4gICAgICAgIHNsaWRlci5lbC5vbignYWN0aXZhdGUnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQuaW5kZXggPT0gNyAmJiBuZWVkX3RvX3N0b3AgKXtcclxuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoX2ludGVydmFsKTtcclxuICAgICAgICAgICAgICAgIG5lZWRfdG9fc3RvcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbm5lckVsbS5hZGRDbGFzcygnd2lubmVyLWVmZmVjdCcpO1xyXG4gICAgICAgICAgICAgICAgfSwgNzAwKVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpbWcuc3JjID0gXCIvcHVibGljL3VwbG9hZC9cIiArIHdpbm5lcl91cmw7XHJcbn1cclxudmFyIHNsaWRlciA9IG51bGw7XHJcbnZhciBfaW50ZXJ2YWwgPSBudWxsOyAgICAgICAgICAgIFxyXG52YXIgbmVlZF90b19zdG9wID0gZmFsc2U7XHJcbnZhciB3aW5uZXJfdXJsID0gbnVsbDtcclxudmFyIHJ1bm5pbmcgPSBmYWxzZTtcclxuXHJcbiQoZnVuY3Rpb24oKXtcclxuICAgIHZhciBkZW1vID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbW8nKTtcclxuICAgIHNsaWRlciA9IG5ldyBCZWUzRChkZW1vLCB7XHJcbiAgICAgICAgZWZmZWN0OiAnY2Fyb3VzZWwnLFxyXG4gICAgICAgIGxpc3RlbmVyczoge1xyXG4gICAgICAgICAgICBrZXlzOiBmYWxzZSxcclxuICAgICAgICAgICAgc2Nyb2xsOiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9vcDoge1xyXG4gICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgICAgICAgICBjb250aW51b3VzOiB0cnVlLFxyXG4gICAgICAgICAgICBvZmZzZXQ6IDhcclxuICAgICAgICB9LFxyXG4gICAgICAgIGF1dG9wbGF5OiB7XHJcbiAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBzcGVlZDogMTAwLFxyXG4gICAgICAgICAgICBwYXVzZUhvdmVyOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgJChkb2N1bWVudCkub24oJ2tleXVwJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgY29uc29sZS5sb2coZS5rZXlDb2RlKTtcclxuICAgICAgICBpZihlLmtleUNvZGUgPT0gODUpe1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvdXBsb2FkLWdhbGxlcnknO1xyXG4gICAgICAgIH1lbHNlIGlmKGUua2V5Q29kZSA9PSA4Nyl7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy93aW5uZXJzJztcclxuICAgICAgICB9ZWxzZSBpZihlLmtleUNvZGUgPT0gMzIpe1xyXG4gICAgICAgICAgICBpZigkKCcjZGVtbycpLmRhdGEoJ3RvdGFsJykgPT0gZ2V0V2lubmVycygpLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAkLnRvYXN0KHsgXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA6ICfEkMOjIFF1YXkgSOG6v3QnLCBcclxuICAgICAgICAgICAgICAgICAgICBzaG93SGlkZVRyYW5zaXRpb24gOiAnc2xpZGUnLCAgXHJcbiAgICAgICAgICAgICAgICAgICAgYmdDb2xvciA6ICcjMDE4NGZmJywgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dENvbG9yIDogJyNmZmYnLCAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGFsbG93VG9hc3RDbG9zZSA6IGZhbHNlLCAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBoaWRlQWZ0ZXIgOiA1MDAwLCAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBzdGFjayA6IDUsICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ24gOiAnbGVmdCcsICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uIDogJ3RvcC1yaWdodCcgXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHJ1bm5pbmcpe1xyXG4gICAgICAgICAgICAgICAgcnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbmVlZF90b19zdG9wID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgZ2V0X3dpbm5lcigpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHJ1bm5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJCgnLndpbm5lci1lZmZlY3QnKS5yZW1vdmVDbGFzcygnd2lubmVyLWVmZmVjdCcpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZV9pbWFnZV9kYXRhKClcclxuICAgICAgICAgICAgICAgIH0sIDUwMClcclxuICAgICAgICAgICAgICAgIF9pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyLmVsLm5leHQoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEzMClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn0pIiwiJ3VzZSBzdHJpY3QnO1xyXG5yZXF1aXJlKCcuL2x1Y2t5ZHJhdycpO1xyXG4iXX0=
