(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

function setWinner(data) {
  var tmp = JSON.stringify(data);
  localStorage.setItem("winners", tmp);
}

function getWinners() {
  var listWorker = localStorage.getItem("winners");

  if (listWorker) {
    return JSON.parse(listWorker);
  }

  return [];
}

function get_winner() {
  $.ajax({
    url: '/get_winner',
    type: 'GET',
    success: function success(winner_name) {
      var winners = getWinners();

      if (winners.includes(winner_name)) {
        get_winner();
        return;
      }

      winners.push(winner_name);
      winner_url = winner_name;
      setWinner(winners);
      handleStop(winner_name);
    }
  });
}

function change_image_data() {
  $.ajax({
    url: '/new_turn',
    type: 'GET',
    dataType: 'json',
    success: function success(data) {
      for (var i = 0; i < data.files.length; i++) {
        var elem = $('.bee3D--slide').eq(i).find('div');
        elem.css({
          background: 'url(public/upload/' + data.files[i] + ') no-repeat 50% 50%',
          backgroundSize: 'cover'
        });
        elem.data('imageUrl', data.files[i]);
      }
    }
  });
}

function handleStop(winner_url) {
  var img = new Image();

  img.onload = function () {
    var winnerElm = $('.bee3D--slide').eq(7).find('div');
    var beforeElm = $('.bee3D--slide').eq(6).find('div');
    var afterElm = $('.bee3D--slide').eq(8).find('div');

    if (afterElm.data('imageUrl') == winner_url) {
      var dummy = $('.bee3D--slide').eq(1).find('div').data('imageUrl');
      afterElm.css({
        background: 'url(public/upload/' + dummy + ') no-repeat 50% 50%',
        backgroundSize: 'cover'
      });
      afterElm.data('imageUrl', dummy);
    }

    if (beforeElm.data('imageUrl') == winner_url) {
      var _dummy = $('.bee3D--slide').eq(8).find('div').data('imageUrl');

      beforeElm.css({
        background: 'url(public/upload/' + _dummy + ') no-repeat 50% 50%',
        backgroundSize: 'cover'
      });
      beforeElm.data('imageUrl', _dummy);
    }

    winnerElm.css({
      background: 'url(public/upload/' + winner_url + ') no-repeat 50% 50%',
      backgroundSize: 'cover'
    });
    winnerElm.data('imageUrl', winner_url);
    slider.el.on('activate', function (event) {
      if (event.index == 7 && need_to_stop) {
        clearInterval(_interval);
        need_to_stop = false;
        setTimeout(function () {
          winnerElm.addClass('winner-effect');
        }, 700);
      }
    });
  };

  img.src = "/public/upload/" + winner_url;
}

var slider = null;
var _interval = null;
var need_to_stop = false;
var winner_url = null;
var running = false;
$(function () {
  var demo = document.getElementById('demo');
  slider = new Bee3D(demo, {
    effect: 'carousel',
    listeners: {
      keys: false,
      scroll: false
    },
    loop: {
      enabled: true,
      continuous: true,
      offset: 8
    },
    autoplay: {
      enabled: false,
      speed: 100,
      pauseHover: true
    }
  });
  $(document).on('keyup', function (e) {
    console.log(e.keyCode);

    if (e.keyCode == 85) {
      window.location.href = '/upload-gallery';
    } else if (e.keyCode == 90) {//change_image_data()
    } else if (e.keyCode == 32) {
      if ($('#demo').data('total') == getWinners().length) {
        $.toast({
          text: 'Đã Quay Hết',
          showHideTransition: 'slide',
          bgColor: '#0184ff',
          textColor: '#fff',
          allowToastClose: false,
          hideAfter: 5000,
          stack: 5,
          textAlign: 'left',
          position: 'top-right'
        });
        return;
      }

      if (running) {
        running = false;
        need_to_stop = true;
        get_winner();
      } else {
        running = true;
        $('.winner-effect').removeClass('winner-effect');
        setTimeout(function () {
          change_image_data();
        }, 500);
        _interval = setInterval(function () {
          slider.el.next();
        }, 130);
      }
    }
  });
});

},{}],2:[function(require,module,exports){
'use strict';

require('./luckydraw');

},{"./luckydraw":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJsaWIvcHVibGljL2pzL2x1Y2t5ZHJhdy5qcyIsImxpYi9wdWJsaWMvanMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsU0FBUyxTQUFULENBQW1CLElBQW5CLEVBQXdCO0FBQ3BCLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBZixDQUFWO0FBQ0EsRUFBQSxZQUFZLENBQUMsT0FBYixDQUFxQixTQUFyQixFQUFnQyxHQUFoQztBQUNIOztBQUVELFNBQVMsVUFBVCxHQUFxQjtBQUNqQixNQUFJLFVBQVUsR0FBRyxZQUFZLENBQUMsT0FBYixDQUFxQixTQUFyQixDQUFqQjs7QUFDQSxNQUFJLFVBQUosRUFBZ0I7QUFDWixXQUFPLElBQUksQ0FBQyxLQUFMLENBQVcsVUFBWCxDQUFQO0FBQ0g7O0FBQ0QsU0FBTyxFQUFQO0FBQ0g7O0FBRUQsU0FBUyxVQUFULEdBQXFCO0FBQ2pCLEVBQUEsQ0FBQyxDQUFDLElBQUYsQ0FBTztBQUNILElBQUEsR0FBRyxFQUFFLGFBREY7QUFFSCxJQUFBLElBQUksRUFBRSxLQUZIO0FBR0gsSUFBQSxPQUFPLEVBQUUsaUJBQVMsV0FBVCxFQUFxQjtBQUMxQixVQUFJLE9BQU8sR0FBRyxVQUFVLEVBQXhCOztBQUNBLFVBQUcsT0FBTyxDQUFDLFFBQVIsQ0FBaUIsV0FBakIsQ0FBSCxFQUFpQztBQUM3QixRQUFBLFVBQVU7QUFDVjtBQUNIOztBQUNELE1BQUEsT0FBTyxDQUFDLElBQVIsQ0FBYSxXQUFiO0FBQ0EsTUFBQSxVQUFVLEdBQUcsV0FBYjtBQUNBLE1BQUEsU0FBUyxDQUFDLE9BQUQsQ0FBVDtBQUNBLE1BQUEsVUFBVSxDQUFDLFdBQUQsQ0FBVjtBQUNIO0FBYkUsR0FBUDtBQWVIOztBQUVELFNBQVMsaUJBQVQsR0FBNEI7QUFDdkIsRUFBQSxDQUFDLENBQUMsSUFBRixDQUFPO0FBQ0osSUFB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QU0sQ0FBQyxFQUFQLENBQVUsSUFBVjtBQUNILFNBRnNCLEVBRXBCLEdBRm9CLENBQXZCO0FBR0g7QUFDSjtBQUNKLEdBcENEO0FBcUNILENBekRBLENBQUQ7OztBQ25HQTs7QUFDQSxPQUFPLENBQUMsYUFBRCxDQUFQIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiZnVuY3Rpb24gc2V0V2lubmVyKGRhdGEpe1xyXG4gICAgbGV0IHRtcCA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ3aW5uZXJzXCIsIHRtcCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFdpbm5lcnMoKXtcclxuICAgIGxldCBsaXN0V29ya2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJ3aW5uZXJzXCIpO1xyXG4gICAgaWYgKGxpc3RXb3JrZXIpIHtcclxuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShsaXN0V29ya2VyKTtcclxuICAgIH1cclxuICAgIHJldHVybiBbXTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0X3dpbm5lcigpe1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6ICcvZ2V0X3dpbm5lcicsXHJcbiAgICAgICAgdHlwZTogJ0dFVCcsXHJcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24od2lubmVyX25hbWUpe1xyXG4gICAgICAgICAgICBsZXQgd2lubmVycyA9IGdldFdpbm5lcnMoKTtcclxuICAgICAgICAgICAgaWYod2lubmVycy5pbmNsdWRlcyh3aW5uZXJfbmFtZSkpe1xyXG4gICAgICAgICAgICAgICAgZ2V0X3dpbm5lcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHdpbm5lcnMucHVzaCh3aW5uZXJfbmFtZSk7XHJcbiAgICAgICAgICAgIHdpbm5lcl91cmwgPSB3aW5uZXJfbmFtZTtcclxuICAgICAgICAgICAgc2V0V2lubmVyKHdpbm5lcnMpO1xyXG4gICAgICAgICAgICBoYW5kbGVTdG9wKHdpbm5lcl9uYW1lKVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjaGFuZ2VfaW1hZ2VfZGF0YSgpe1xyXG4gICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiAnL25ld190dXJuJyxcclxuICAgICAgICB0eXBlOiAnR0VUJyxcclxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZGF0YS5maWxlcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBsZXQgZWxlbSA9ICQoJy5iZWUzRC0tc2xpZGUnKS5lcShpKS5maW5kKCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGVsZW0uY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKHB1YmxpYy91cGxvYWQvJysgZGF0YS5maWxlc1tpXSArICcpIG5vLXJlcGVhdCA1MCUgNTAlJyxcclxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJ2NvdmVyJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtLmRhdGEoJ2ltYWdlVXJsJywgZGF0YS5maWxlc1tpXSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVTdG9wKHdpbm5lcl91cmwpe1xyXG4gICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBsZXQgd2lubmVyRWxtID0gJCgnLmJlZTNELS1zbGlkZScpLmVxKDcpLmZpbmQoJ2RpdicpO1xyXG4gICAgICAgIGxldCBiZWZvcmVFbG0gPSAkKCcuYmVlM0QtLXNsaWRlJykuZXEoNikuZmluZCgnZGl2Jyk7XHJcbiAgICAgICAgbGV0IGFmdGVyRWxtID0gJCgnLmJlZTNELS1zbGlkZScpLmVxKDgpLmZpbmQoJ2RpdicpO1xyXG5cclxuICAgICAgICBpZihhZnRlckVsbS5kYXRhKCdpbWFnZVVybCcpID09IHdpbm5lcl91cmwpe1xyXG4gICAgICAgICAgICBsZXQgZHVtbXkgPSAkKCcuYmVlM0QtLXNsaWRlJykuZXEoMSkuZmluZCgnZGl2JykuZGF0YSgnaW1hZ2VVcmwnKTtcclxuICAgICAgICAgICAgYWZ0ZXJFbG0uY3NzKHtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwocHVibGljL3VwbG9hZC8nKyBkdW1teSArICcpIG5vLXJlcGVhdCA1MCUgNTAlJyxcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnY292ZXInXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBhZnRlckVsbS5kYXRhKCdpbWFnZVVybCcsIGR1bW15KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoYmVmb3JlRWxtLmRhdGEoJ2ltYWdlVXJsJykgPT0gd2lubmVyX3VybCl7XHJcbiAgICAgICAgICAgIGxldCBkdW1teSA9ICQoJy5iZWUzRC0tc2xpZGUnKS5lcSg4KS5maW5kKCdkaXYnKS5kYXRhKCdpbWFnZVVybCcpO1xyXG4gICAgICAgICAgICBiZWZvcmVFbG0uY3NzKHtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwocHVibGljL3VwbG9hZC8nKyBkdW1teSArICcpIG5vLXJlcGVhdCA1MCUgNTAlJyxcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnY292ZXInXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBiZWZvcmVFbG0uZGF0YSgnaW1hZ2VVcmwnLCBkdW1teSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHdpbm5lckVsbS5jc3Moe1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKHB1YmxpYy91cGxvYWQvJysgd2lubmVyX3VybCArICcpIG5vLXJlcGVhdCA1MCUgNTAlJyxcclxuICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICdjb3ZlcidcclxuICAgICAgICB9KTtcclxuICAgICAgICB3aW5uZXJFbG0uZGF0YSgnaW1hZ2VVcmwnLCB3aW5uZXJfdXJsKVxyXG5cclxuICAgICAgICBzbGlkZXIuZWwub24oJ2FjdGl2YXRlJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LmluZGV4ID09IDcgJiYgbmVlZF90b19zdG9wICl7XHJcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKF9pbnRlcnZhbCk7XHJcbiAgICAgICAgICAgICAgICBuZWVkX3RvX3N0b3AgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICB3aW5uZXJFbG0uYWRkQ2xhc3MoJ3dpbm5lci1lZmZlY3QnKTtcclxuICAgICAgICAgICAgICAgIH0sIDcwMClcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaW1nLnNyYyA9IFwiL3B1YmxpYy91cGxvYWQvXCIgKyB3aW5uZXJfdXJsO1xyXG59XHJcbnZhciBzbGlkZXIgPSBudWxsO1xyXG52YXIgX2ludGVydmFsID0gbnVsbDsgICAgICAgICAgICBcclxudmFyIG5lZWRfdG9fc3RvcCA9IGZhbHNlO1xyXG52YXIgd2lubmVyX3VybCA9IG51bGw7XHJcbnZhciBydW5uaW5nID0gZmFsc2U7XHJcblxyXG4kKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgZGVtbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZW1vJyk7XHJcbiAgICBzbGlkZXIgPSBuZXcgQmVlM0QoZGVtbywge1xyXG4gICAgICAgIGVmZmVjdDogJ2Nhcm91c2VsJyxcclxuICAgICAgICBsaXN0ZW5lcnM6IHtcclxuICAgICAgICAgICAga2V5czogZmFsc2UsXHJcbiAgICAgICAgICAgIHNjcm9sbDogZmFsc2VcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxvb3A6IHtcclxuICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgICAgY29udGludW91czogdHJ1ZSxcclxuICAgICAgICAgICAgb2Zmc2V0OiA4XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhdXRvcGxheToge1xyXG4gICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgc3BlZWQ6IDEwMCxcclxuICAgICAgICAgICAgcGF1c2VIb3ZlcjogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgICQoZG9jdW1lbnQpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGUua2V5Q29kZSk7XHJcbiAgICAgICAgaWYoZS5rZXlDb2RlID09IDg1KXtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3VwbG9hZC1nYWxsZXJ5JztcclxuICAgICAgICB9ZWxzZSBpZihlLmtleUNvZGUgPT0gOTApe1xyXG4gICAgICAgICAgICAvL2NoYW5nZV9pbWFnZV9kYXRhKClcclxuICAgICAgICB9ZWxzZSBpZihlLmtleUNvZGUgPT0gMzIpe1xyXG4gICAgICAgICAgICBpZigkKCcjZGVtbycpLmRhdGEoJ3RvdGFsJykgPT0gZ2V0V2lubmVycygpLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAkLnRvYXN0KHsgXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA6ICfEkMOjIFF1YXkgSOG6v3QnLCBcclxuICAgICAgICAgICAgICAgICAgICBzaG93SGlkZVRyYW5zaXRpb24gOiAnc2xpZGUnLCAgXHJcbiAgICAgICAgICAgICAgICAgICAgYmdDb2xvciA6ICcjMDE4NGZmJywgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dENvbG9yIDogJyNmZmYnLCAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGFsbG93VG9hc3RDbG9zZSA6IGZhbHNlLCAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBoaWRlQWZ0ZXIgOiA1MDAwLCAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBzdGFjayA6IDUsICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ24gOiAnbGVmdCcsICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uIDogJ3RvcC1yaWdodCcgXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHJ1bm5pbmcpe1xyXG4gICAgICAgICAgICAgICAgcnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbmVlZF90b19zdG9wID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgZ2V0X3dpbm5lcigpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHJ1bm5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJCgnLndpbm5lci1lZmZlY3QnKS5yZW1vdmVDbGFzcygnd2lubmVyLWVmZmVjdCcpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZV9pbWFnZV9kYXRhKClcclxuICAgICAgICAgICAgICAgIH0sIDUwMClcclxuICAgICAgICAgICAgICAgIF9pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyLmVsLm5leHQoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEzMClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn0pIiwiJ3VzZSBzdHJpY3QnO1xyXG5yZXF1aXJlKCcuL2x1Y2t5ZHJhdycpO1xyXG4iXX0=
